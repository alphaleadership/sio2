Test sp√©cifique d'un cas probl√©matique:

=== Test sp√©cifique d'un cas de dossier probl√©matique ===

folderPath: D:\partage\uploads
file.relativePath: uploads/documents/document.pdf
potentialPath: D:\partage\uploads\uploads\documents\document.pdf
pathParts: [D:, partage, uploads, uploads, documents, document.pdf]
hasDuplication: true
‚Üí Duplication d√©tect√©e, utilise basename: document.pdf
finalPath: D:\partage\uploads\document.pdf
expectedPath: D:\partage\uploads\document.pdf

R√©sultat: ‚úÖ CORRECT

============================================================

Test complet des uploads de dossiers:
=== Test des uploads de dossiers avec plusieurs fichiers ===

Base directory: D:\partage

Test: Upload de dossier simple sans duplication
  req.body.path: "projects"
  Nombre de fichiers: 2
  destFolder: D:\partage\projects
  isFolderUpload: true

  Fichier 1: index.html
    webkitRelativePath: mon-site/index.html
    relativePath: mon-site/index.html
    ‚Üí Pas de duplication, utilise chemin complet: mon-site/index.html
    filePath final: D:\partage\projects\mon-site\index.html
    attendu: D:\partage\projects\mon-site\index.html
    match: ‚úì
      ‚úì Pas de duplication finale

  Fichier 2: style.css
    webkitRelativePath: mon-site/css/style.css
    relativePath: mon-site/css/style.css
    ‚Üí Pas de duplication, utilise chemin complet: mon-site/css/style.css
    filePath final: D:\partage\projects\mon-site\css\style.css
    attendu: D:\partage\projects\mon-site\css\style.css
    match: ‚úì
      ‚úì Pas de duplication finale

  R√©sultat global: ‚úì PASS

Test: Upload de dossier avec duplication potentielle
  req.body.path: "projects"
  Nombre de fichiers: 2
  destFolder: D:\partage\projects
  isFolderUpload: true

  Fichier 1: index.html
    webkitRelativePath: projects/mon-site/index.html
    relativePath: projects/mon-site/index.html
    ‚Üí Duplication d√©tect√©e, utilise basename: index.html
    filePath final: D:\partage\projects\index.html
    attendu: D:\partage\projects\index.html
    match: ‚úì
      ‚úì Pas de duplication finale

  Fichier 2: style.css
    webkitRelativePath: projects/css/style.css
    relativePath: projects/css/style.css
    ‚Üí Duplication d√©tect√©e, utilise basename: style.css
    filePath final: D:\partage\projects\style.css
    attendu: D:\partage\projects\style.css
    match: ‚úì
      ‚úì Pas de duplication finale

  R√©sultat global: ‚úì PASS

Test: Upload de dossier mixte (avec et sans duplication)
  req.body.path: "uploads"
  Nombre de fichiers: 2
  destFolder: D:\partage\uploads
  isFolderUpload: true

  Fichier 1: readme.md
    webkitRelativePath: projet/readme.md
    relativePath: projet/readme.md
    ‚Üí Pas de duplication, utilise chemin complet: projet/readme.md
    filePath final: D:\partage\uploads\projet\readme.md
    attendu: D:\partage\uploads\projet\readme.md
    match: ‚úì
      ‚úì Pas de duplication finale

  Fichier 2: config.json
    webkitRelativePath: uploads/config.json
    relativePath: uploads/config.json
    ‚Üí Duplication d√©tect√©e, utilise basename: config.json
    filePath final: D:\partage\uploads\config.json
    attendu: D:\partage\uploads\config.json
    match: ‚úì
      ‚úì Pas de duplication finale

  R√©sultat global: ‚úì PASS

=== Tests des cas edge pour dossiers ===

Test edge: Dossier avec structure profonde et duplication
  Fichier: file.txt
  relativePath: deep/level1/deep/file.txt
  potentialPath: D:\partage\deep\deep\level1\deep\file.txt
  pathParts: [D:, partage, deep, deep, level1, deep, file.txt]
  ‚ö†Ô∏è  Duplications d√©tect√©es:
    - "deep" √† la position 3
  ‚Üí Correction: utilise basename "file.txt"
  ‚Üí Chemin final: D:\partage\deep\file.txt

Test edge: Dossier avec duplications multiples
  Fichier: file1.txt
  relativePath: test/test/test/file1.txt
  potentialPath: D:\partage\test\test\test\test\file1.txt
  pathParts: [D:, partage, test, test, test, test, file1.txt]
  ‚ö†Ô∏è  Duplications d√©tect√©es:
    - "test" √† la position 3
    - "test" √† la position 4
    - "test" √† la position 5
  ‚Üí Correction: utilise basename "file1.txt"
  ‚Üí Chemin final: D:\partage\test\file1.txt

Test edge: Dossier sans duplication mais avec r√©p√©tition l√©gitime
  Fichier: project.js
  relativePath: my-project/project-files/project.js
  potentialPath: D:\partage\projects\my-project\project-files\project.js
  pathParts: [D:, partage, projects, my-project, project-files, project.js]
  ‚úì Aucune duplication d√©tect√©e
  ‚Üí Chemin final: D:\partage\projects\my-project\project-files\project.js

=== R√©sum√© ===
üéâ Tous les tests de dossiers sont pass√©s !

Logique anti-duplication pour dossiers confirm√©e:
- D√©tection de duplication pour chaque fichier du dossier
- Correction automatique avec basename quand n√©cessaire
- Pr√©servation des structures l√©gitimes
- Gestion des cas edge complexes

=== R√âSULTAT FINAL ===
Cas sp√©cifique: ‚úÖ
Tous les tests de dossiers: ‚úÖ
Succ√®s global: ‚úÖ

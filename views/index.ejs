<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Explorateur de fichiers</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 30px; }
        .file-list { list-style: none; padding: 0; }
        .file-item { padding: 8px 12px; border-bottom: 1px solid #eee; display: flex; align-items: center; }
        .file-icon { margin-right: 10px; }
        .folder { font-weight: bold; color: #2a5d9f; cursor: pointer; }
        .file { color: #444; }
    </style>
</head>
<body>
                <div style="display:flex;justify-content:space-between;align-items:center;">
                        <h1>Explorateur de fichiers</h1>
                        <div>
                            <% if (typeof user !== 'undefined' && user && user.role === 'admin') { %>
                                <a href="/admin/users/manage" style="padding:8px 16px;background:#4caf50;color:#fff;text-decoration:none;border-radius:4px;margin-right:8px;">G√©rer les utilisateurs</a>
                            <% } %>
                            <a href="/login" style="padding:8px 16px;background:#2a5d9f;color:#fff;text-decoration:none;border-radius:4px;">Login</a>
                        </div>
                </div>
    <form action="/upload" method="post" enctype="multipart/form-data">
  <input type="file" name="file" webkitdirectory directory multiple required>
  <input type="hidden" name="path" value="<%= path || '' %>">
  <button type="submit">Uploader dossier</button>
</form>
    <% 
    // Calcul du chemin du dossier parent
    let parentPath = null;
    if (path && path !== '' && path !== '/') {
        let parts = path.split('/').filter(Boolean);
        parts.pop();
        parentPath = parts.length ? ('/' + parts.join('/')) : '';
    }
    %>
    <% if (parentPath !== null) { %>
        <div style="margin-bottom: 10px;">
            <a href="?path=<%= encodeURIComponent(parentPath) %>">‚¨ÖÔ∏è Dossier pr√©c√©dent</a>
        </div>
    <% } %>
        <% if (typeof rootChoices !== 'undefined' && rootChoices && rootChoices.length) { %>
            <ul class="file-list">
                <% rootChoices.forEach(function(choice) { %>
                    <li class="file-item">
                        <span class="file-icon">üìÅ</span>
                        <span class="folder">
                            <a href="?path=<%= encodeURIComponent(choice.path) %>"><%= choice.name %></a>
                        </span>
                    </li>
                <% }); %>
            </ul>
        <% } else { %>
            <ul class="file-list">
                <% if (files && files.length) { %>
                        <% files.forEach(function(file) { %>
                                <li class="file-item">
                                        <% if (file.isDirectory) { %>
        <span class="file-icon">üìÅ</span>
        <span class="folder">
                <a href="?path=<%= encodeURIComponent(file.relativePath) %>"><%= file.name %></a>
        </span>
<% } else { %>
        <span class="file-icon">üìÑ</span>
        <span class="file">
                <a href="/download?file=<%= encodeURIComponent(file.relativePath) %>" download><%= file.name %></a>
        </span>
        <form action="/delete" method="post" style="display:inline" onsubmit="return confirm('Supprimer ce fichier ?');">
                <input type="hidden" name="file" value="<%= file.relativePath %>">
                <button type="submit" style="background:none;border:none;color:#c00;cursor:pointer;" title="Supprimer">
                        üóëÔ∏è
                </button>
        </form>
<% } %>
                                </li>
                        <% }); %>
                <% } else { %>
                        <li>Aucun fichier ou dossier trouv√©.</li>
                <% } %>
            </ul>
        <% } %>
</body>
</html>